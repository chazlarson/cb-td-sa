<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_hjz5jk7cyvkh-4.start{counter-reset:lst-ctn-kix_hjz5jk7cyvkh-4 0}.lst-kix_4ntde9undnqh-7>li:before{content:"" counter(lst-ctn-kix_4ntde9undnqh-7,lower-latin) ". "}.lst-kix_4ntde9undnqh-6>li:before{content:"" counter(lst-ctn-kix_4ntde9undnqh-6,decimal) ". "}.lst-kix_4ntde9undnqh-2>li{counter-increment:lst-ctn-kix_4ntde9undnqh-2}.lst-kix_4ntde9undnqh-5>li:before{content:"" counter(lst-ctn-kix_4ntde9undnqh-5,lower-roman) ". "}ol.lst-kix_hjz5jk7cyvkh-1.start{counter-reset:lst-ctn-kix_hjz5jk7cyvkh-1 0}.lst-kix_hjz5jk7cyvkh-6>li{counter-increment:lst-ctn-kix_hjz5jk7cyvkh-6}.lst-kix_4ntde9undnqh-8>li{counter-increment:lst-ctn-kix_4ntde9undnqh-8}ol.lst-kix_4ntde9undnqh-0.start{counter-reset:lst-ctn-kix_4ntde9undnqh-0 0}.lst-kix_4ntde9undnqh-4>li:before{content:"" counter(lst-ctn-kix_4ntde9undnqh-4,lower-latin) ". "}.lst-kix_hjz5jk7cyvkh-1>li{counter-increment:lst-ctn-kix_hjz5jk7cyvkh-1}.lst-kix_4ntde9undnqh-3>li{counter-increment:lst-ctn-kix_4ntde9undnqh-3}ol.lst-kix_4ntde9undnqh-7.start{counter-reset:lst-ctn-kix_4ntde9undnqh-7 0}ol.lst-kix_hjz5jk7cyvkh-7.start{counter-reset:lst-ctn-kix_hjz5jk7cyvkh-7 0}.lst-kix_4ntde9undnqh-8>li:before{content:"" counter(lst-ctn-kix_4ntde9undnqh-8,lower-roman) ". "}.lst-kix_hjz5jk7cyvkh-8>li{counter-increment:lst-ctn-kix_hjz5jk7cyvkh-8}ol.lst-kix_hjz5jk7cyvkh-5.start{counter-reset:lst-ctn-kix_hjz5jk7cyvkh-5 0}.lst-kix_4ntde9undnqh-1>li{counter-increment:lst-ctn-kix_4ntde9undnqh-1}ol.lst-kix_4ntde9undnqh-0{list-style-type:none}ol.lst-kix_4ntde9undnqh-2{list-style-type:none}.lst-kix_hjz5jk7cyvkh-0>li{counter-increment:lst-ctn-kix_hjz5jk7cyvkh-0}ol.lst-kix_hjz5jk7cyvkh-8.start{counter-reset:lst-ctn-kix_hjz5jk7cyvkh-8 0}ol.lst-kix_4ntde9undnqh-1{list-style-type:none}ol.lst-kix_4ntde9undnqh-4{list-style-type:none}ol.lst-kix_4ntde9undnqh-3{list-style-type:none}ol.lst-kix_4ntde9undnqh-3.start{counter-reset:lst-ctn-kix_4ntde9undnqh-3 0}ol.lst-kix_4ntde9undnqh-6{list-style-type:none}.lst-kix_hjz5jk7cyvkh-3>li{counter-increment:lst-ctn-kix_hjz5jk7cyvkh-3}ol.lst-kix_4ntde9undnqh-5{list-style-type:none}ol.lst-kix_4ntde9undnqh-8{list-style-type:none}ol.lst-kix_4ntde9undnqh-7{list-style-type:none}.lst-kix_4ntde9undnqh-7>li{counter-increment:lst-ctn-kix_4ntde9undnqh-7}ol.lst-kix_4ntde9undnqh-6.start{counter-reset:lst-ctn-kix_4ntde9undnqh-6 0}.lst-kix_4ntde9undnqh-4>li{counter-increment:lst-ctn-kix_4ntde9undnqh-4}ol.lst-kix_4ntde9undnqh-5.start{counter-reset:lst-ctn-kix_4ntde9undnqh-5 0}.lst-kix_hjz5jk7cyvkh-4>li{counter-increment:lst-ctn-kix_hjz5jk7cyvkh-4}.lst-kix_hjz5jk7cyvkh-8>li:before{content:"" counter(lst-ctn-kix_hjz5jk7cyvkh-8,lower-roman) ". "}ol.lst-kix_hjz5jk7cyvkh-6.start{counter-reset:lst-ctn-kix_hjz5jk7cyvkh-6 0}.lst-kix_hjz5jk7cyvkh-7>li:before{content:"" counter(lst-ctn-kix_hjz5jk7cyvkh-7,lower-latin) ". "}.lst-kix_4ntde9undnqh-5>li{counter-increment:lst-ctn-kix_4ntde9undnqh-5}ol.lst-kix_hjz5jk7cyvkh-2{list-style-type:none}ol.lst-kix_hjz5jk7cyvkh-1{list-style-type:none}ol.lst-kix_hjz5jk7cyvkh-0{list-style-type:none}.lst-kix_4ntde9undnqh-0>li{counter-increment:lst-ctn-kix_4ntde9undnqh-0}.lst-kix_hjz5jk7cyvkh-4>li:before{content:"" counter(lst-ctn-kix_hjz5jk7cyvkh-4,lower-latin) ". "}ol.lst-kix_4ntde9undnqh-2.start{counter-reset:lst-ctn-kix_4ntde9undnqh-2 0}.lst-kix_4ntde9undnqh-6>li{counter-increment:lst-ctn-kix_4ntde9undnqh-6}.lst-kix_hjz5jk7cyvkh-5>li:before{content:"" counter(lst-ctn-kix_hjz5jk7cyvkh-5,lower-roman) ". "}.lst-kix_hjz5jk7cyvkh-3>li:before{content:"" counter(lst-ctn-kix_hjz5jk7cyvkh-3,decimal) ". "}.lst-kix_hjz5jk7cyvkh-6>li:before{content:"" counter(lst-ctn-kix_hjz5jk7cyvkh-6,decimal) ". "}.lst-kix_hjz5jk7cyvkh-2>li:before{content:"" counter(lst-ctn-kix_hjz5jk7cyvkh-2,lower-roman) ". "}ol.lst-kix_hjz5jk7cyvkh-2.start{counter-reset:lst-ctn-kix_hjz5jk7cyvkh-2 0}.lst-kix_hjz5jk7cyvkh-5>li{counter-increment:lst-ctn-kix_hjz5jk7cyvkh-5}.lst-kix_hjz5jk7cyvkh-2>li{counter-increment:lst-ctn-kix_hjz5jk7cyvkh-2}ol.lst-kix_hjz5jk7cyvkh-0.start{counter-reset:lst-ctn-kix_hjz5jk7cyvkh-0 0}.lst-kix_hjz5jk7cyvkh-1>li:before{content:"" counter(lst-ctn-kix_hjz5jk7cyvkh-1,lower-latin) ". "}ol.lst-kix_4ntde9undnqh-4.start{counter-reset:lst-ctn-kix_4ntde9undnqh-4 0}.lst-kix_hjz5jk7cyvkh-0>li:before{content:"" counter(lst-ctn-kix_hjz5jk7cyvkh-0,decimal) ". "}ol.lst-kix_hjz5jk7cyvkh-6{list-style-type:none}.lst-kix_4ntde9undnqh-1>li:before{content:"" counter(lst-ctn-kix_4ntde9undnqh-1,lower-latin) ". "}ol.lst-kix_4ntde9undnqh-8.start{counter-reset:lst-ctn-kix_4ntde9undnqh-8 0}ol.lst-kix_hjz5jk7cyvkh-5{list-style-type:none}ol.lst-kix_hjz5jk7cyvkh-4{list-style-type:none}ol.lst-kix_hjz5jk7cyvkh-3{list-style-type:none}.lst-kix_4ntde9undnqh-3>li:before{content:"" counter(lst-ctn-kix_4ntde9undnqh-3,decimal) ". "}.lst-kix_hjz5jk7cyvkh-7>li{counter-increment:lst-ctn-kix_hjz5jk7cyvkh-7}ol.lst-kix_hjz5jk7cyvkh-8{list-style-type:none}.lst-kix_4ntde9undnqh-2>li:before{content:"" counter(lst-ctn-kix_4ntde9undnqh-2,lower-roman) ". "}ol.lst-kix_hjz5jk7cyvkh-7{list-style-type:none}ol.lst-kix_4ntde9undnqh-1.start{counter-reset:lst-ctn-kix_4ntde9undnqh-1 0}.lst-kix_4ntde9undnqh-0>li:before{content:"" counter(lst-ctn-kix_4ntde9undnqh-0,decimal) ". "}ol.lst-kix_hjz5jk7cyvkh-3.start{counter-reset:lst-ctn-kix_hjz5jk7cyvkh-3 0}ol{margin:0;padding:0}table td,table th{padding:0}.c4{background-color:#b6d7a8;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Courier New";font-style:normal}.c30{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c29{padding-top:16pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c26{padding-top:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c18{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c3{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c27{color:#434343;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c19{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c35{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-style:normal}.c31{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-style:normal}.c7{background-color:#ff9900;color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:normal}.c8{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:normal}.c11{color:#000000;text-decoration:none;vertical-align:baseline;font-size:10pt;font-style:normal}.c22{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c14{background-color:#b6d7a8;font-weight:700;font-family:"Courier New"}.c37{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c6{margin-left:36pt;padding-left:0pt}.c32{color:inherit;text-decoration:inherit}.c20{font-weight:700;font-family:"Courier New"}.c5{font-weight:400;font-family:"Courier New"}.c2{margin-left:36pt;margin-right:36pt}.c12{padding:0;margin:0}.c34{background-color:#b6d7a8}.c33{height:20pt}.c16{font-size:10pt}.c28{font-family:"Arial"}.c25{background-color:#ffd966}.c36{color:#ff0000}.c9{padding-left:0pt}.c24{text-indent:36pt}.c23{background-color:#9fc5e8}.c15{background-color:#ff9900}.c13{height:11pt}.c1{margin-left:72pt}.c10{background-color:#f6b26b}.c17{margin-left:108pt}.c21{font-weight:700}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c37"><p class="c30 title" id="h.6ktsr7zad98"><span class="c28 c35">Teamdrive/Service Account setup for Cloudbox:</span></p><p class="c0"><span class="c8 c28 c21">NOTE: This is the work of a random cloudbox user, not one of the core dev team. &nbsp;This setup works for me, though.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">So, you want to add a teamdrive to your cloudbox setup and configure cloudplow to upload to that teamdrive? &nbsp;And you&rsquo;re interested in doing this so you can circumvent Google&rsquo;s 750Gb daily upload limit?</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Here&rsquo;s a description of how I configured cloudbox to do that. &nbsp;There&rsquo;s an outline, and then a detailed section with screenshots and more detail on exactly WHY I&rsquo;m asking you to do this and that.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c21">PLEASE, READ THROUGH THIS ENTIRE THING BEFORE YOU DO ANYTHING. </span><span class="c3">That way you&rsquo;ll have a handle on what things you&rsquo;ll need from earlier steps and the later steps may influence your decisions about earlier steps. &nbsp;Also, it&rsquo;s always better to clear up questions before you&rsquo;re in the middle of it.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">This document is written as if you are adding a single teamdrive. &nbsp;There are some notes herein describing what parts need to be repeated for multiple teamdrives.</span></p><h1 class="c26" id="h.pr4suq5z8x19"><span class="c31 c28">Outline:</span></h1><ol class="c12 lst-kix_4ntde9undnqh-0 start" start="1"><li class="c0 c6"><span class="c3">Create service accounts</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span class="c3">Typically, the reason for doing this is to get around the 750Gb upload limit, so you&rsquo;ll probably want to create more than one.</span></li><li class="c0 c9 c1"><span>Save the JSON for the service accounts somewhere that cloudplow will be able to see them.<br>For the examples below, I will assume you put them in:<br></span><span class="c8 c5">/opt/sa-json</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="2"><li class="c0 c6"><span class="c3">Create a new OAuth user for use with this teamdrive</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span class="c3">Use the same method as you did initially for Cloudbox</span></li><li class="c0 c9 c1"><span class="c3">Maybe not strictly necessary, but they are free so why not?</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-2 start" start="1"><li class="c0 c9 c17"><span class="c3">Helps avoid API bans</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1" start="3"><li class="c0 c9 c1"><span class="c3">You will use the Client ID and Secret for rclone later.</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="3"><li class="c0 c6"><span class="c3">Create the Teamdrive</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span class="c3">Chances are you want the file structure here to match the cloudbox-related portion of My Drive, since you probably want this stuff to just show up in Plex automagically without adding new folders to your library configs.</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-2 start" start="1"><li class="c0 c9 c17"><span class="c5">/Media/Movies<br>/Media/TV<br></span><span>a</span><span class="c3">nd so forth...</span></li><li class="c0 c9 c17"><span>I added a folder to the root of each teamdrive so I can tell at a glance if the teamdrive has been successfully merged into the mergerfs at </span><span class="c5">/mnt/unionfs</span><span>. &nbsp;<br>For example:<br></span><span class="c8 c5">/TD-Teamdrive</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="4"><li class="c0 c6"><span class="c3">Share the teamdrive with the service accounts using their email address</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span>I gave all the service accounts &ldquo;Manager&rdquo; privileges, since they will be used in very limited circumstances all entirely under my control and I figure why not give them </span><span class="c21">All The Privs</span><span class="c3">&nbsp;so they can do whatever they may need to do behind the scenes.</span></li><li class="c0 c9 c1"><span class="c3">If you have a lot of service accounts [I have 100], create a Google Group, add all the service account emails to the Google Group, then share the teamdrive with the group&rsquo;s email address.</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="5"><li class="c0 c6"><span class="c3">Create an rclone remote for the teamdrive.</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span class="c3">Enter the clientID and secret from the user you created above.</span></li><li class="c0 c1 c9"><span class="c3">Go through the rclone setup just the same as you did for the original rclone remote you created for Cloudbox.</span></li><li class="c0 c9 c1"><span class="c3">After authorizing, you&rsquo;ll be asked if you want to set this drive up as a teamdrive. &nbsp;Answer &ldquo;yes&rdquo;; you&rsquo;ll be shown a list of teamdrives from which to choose.</span></li><li class="c0 c9 c1"><span class="c3">You will need the name of this remote when you set up the rclone_vfs mount.<br>In the examples below, I will assume you called it &ldquo;teamdrive&rdquo;.</span></li><li class="c0 c9 c1"><span class="c8 c21 c28">I STRONGLY SUGGEST that you make this name all lower case with no spaces and use it from now on throughout this setup wherever you refer to this teamdrive. &nbsp;Something like &ldquo;teamdrive-books&rdquo;, &ldquo;teamdrive-shared-movies&rdquo;, etc.</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="6"><li class="c0 c6"><span class="c3">Create a mount point for the teamdrive</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span>Create a directory where you want to mount this teamdrive under the /mnt directory: for example:<br></span><span class="c5">/mnt/remote-teamdrive<br></span><span>You may have to use sudo to create the directory:<br></span><span class="c8 c5">sudo mkdir /mnt/remote-teamdrive</span></li><li class="c0 c9 c1"><span>It should be on the root level of /mnt; not within any other remote mount directory.<br>NOT, for example:<br></span><span class="c5">/mnt/remote/remote-teamdrive<br></span><span>OR:<br></span><span class="c5">/mnt/unionfs/remote-teamdrive<br></span><span>OR:<br></span><span class="c8 c5">/mnt/local/remote-teamdrive</span></li></ol><p class="c0 c1"><span class="c3">etc.</span></p><ol class="c12 lst-kix_4ntde9undnqh-1" start="3"><li class="c0 c9 c1"><span class="c3">Make sure it has the same ownership and permissions as the existing /mnt/remote:</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-2 start" start="1"><li class="c0 c9 c17"><span class="c8 c5">&#10140; &nbsp;~ ls -al /mnt</span></li></ol><p class="c0 c17"><span class="c8 c5">total 16</span></p><p class="c0 c17"><span class="c8 c5">drwxr-xr-x 1 root root 168 May &nbsp;8 18:35 .</span></p><p class="c0 c17"><span class="c8 c5">drwxr-xr-x 1 root root 334 May 18 18:53 ..</span></p><p class="c0 c17"><span class="c8 c5">drwxrwxr-x 1 seed seed &nbsp;48 May &nbsp;8 19:08 local</span></p><p class="c0 c17"><span class="c8 c5 c25">drwxrwxr-x 1 seed seed &nbsp; 0 May 20 23:16 remote</span></p><p class="c0 c17"><span class="c8 c5">drwxrwxr-x 1 seed seed &nbsp;48 May &nbsp;8 19:08 unionfs</span></p><ol class="c12 lst-kix_4ntde9undnqh-2" start="2"><li class="c0 c9 c17"><span>To do this:<br></span><span class="c8 c5">sudo chown -R seed:seed /mnt/remote-teamdrive<br>sudo chmod -R g+w /mnt/remote-teamdrive</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1" start="4"><li class="c0 c9 c1"><span class="c3">You will use this mountpoint when you configure the rclone_vfs service.</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="7"><li class="c0 c6"><span class="c3">Make copies of the rclone_vfs service files for use with this teamdrive</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span>The files you need to copy are:<br></span><span class="c8 c5">/etc/systemd/system/rclone_vfs.service</span></li></ol><p class="c0 c1"><span class="c8 c5">/etc/systemd/system/rclone_vfs_primer.service &nbsp;/etc/systemd/system/rclone_vfs_primer.timer &nbsp;</span></p><ol class="c12 lst-kix_4ntde9undnqh-1" start="2"><li class="c0 c9 c1"><span>Copy those for each teamdrive. &nbsp;I&rsquo;ll use these for examples:<br></span><span class="c8 c5">/etc/systemd/system/teamdrive_vfs.service</span></li></ol><p class="c0 c1"><span class="c8 c5">/etc/systemd/system/teamdrive_vfs_primer.service &nbsp;/etc/systemd/system/teamdrive_vfs_primer.timer</span></p><ol class="c12 lst-kix_4ntde9undnqh-1" start="3"><li class="c0 c9 c1"><span class="c3">You&rsquo;re going to edit the contents of those files. &nbsp;In addition to the edits listed below, I changed comments and descriptions in each one but I don&rsquo;t discuss those changes below.</span></li><li class="c0 c9 c1"><span>Edit </span><span class="c5">/etc/systemd/system/teamdrive_vfs.service</span><span class="c3">:</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-2 start" start="1"><li class="c0 c9 c17"><span>Change the port [5572] in this line [line 26 at this writing]:<br></span><span class="c5">&nbsp; --rc-addr=localhost:5572 \<br></span><span class="c3">The specific port you use doesn&rsquo;t matter, but maybe just use 5573.</span></li><li class="c0 c9 c17"><span>Change the remote name and mount directory in this line [line 44 at this writing]:<br></span><span class="c5">&nbsp; google: /mnt/remote<br></span><span>The first bit before the colon is the name of the rclone remote from step 5.<br>The path is the mount point you created in step 6.<br>For example, you might end up with something like this:<br></span><span class="c8 c5">&nbsp; teamdrive: /mnt/remote-teamdrive</span></li><li class="c0 c9 c17"><span>Change the next line to match the path you just entered:<br></span><span class="c5">ExecStop=/bin/fusermount -uz /mnt/remote<br></span><span>For example:<br></span><span class="c8 c5">ExecStop=/bin/fusermount -uz /mnt/remote-teamdrive</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1" start="5"><li class="c0 c9 c1"><span>Edit </span><span class="c5">/etc/systemd/system/teamdrive_vfs_primer.service</span><span class="c3">:</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-2 start" start="1"><li class="c0 c9 c17"><span>Change these two lines [lines 14-15 at this writing]:<br></span><span class="c8 c5">Requires=rclone_vfs.service</span></li></ol><p class="c0 c17"><span class="c5">After=rclone_vfs.service<br></span><span>To match the name of the service file you just edited, for example:<br></span><span class="c8 c5">Requires=teamdrive_rclone_vfs.service</span></p><p class="c0 c17"><span class="c8 c5">After=teamdrive_rclone_vfs.service</span></p><ol class="c12 lst-kix_4ntde9undnqh-2" start="2"><li class="c0 c9 c17"><span>Change the port [5572] in this line [line 27 at this writing]:<br></span><span class="c5">&nbsp; --rc-addr=localhost:5572 \<br></span><span class="c3">Use the port you entered into the service file in the previous step.</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1" start="6"><li class="c0 c9 c1"><span>There are no required internal changes to:<br></span><span class="c5">/etc/systemd/system/teamdrive_vfs_primer.timer<br></span><span class="c3">However, as mentioned above, I changed the file comments and descriptions within the file.</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="8"><li class="c0 c6"><span class="c3">Edit the mergerfs service file to include the new teamdrive in the mergerfs.</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span>Edit this file:<br></span><span class="c8 c5">/etc/systemd/system/mergerfs.service</span></li><li class="c0 c9 c1"><span>Edit this line to include your new teamdrive:<br></span><span class="c5">/mnt/local=RW:/mnt/remote=NC /mnt/unionfs</span><span><br>For example:<br></span><span class="c8 c5">/mnt/local=RW:/mnt/remote=NC:/mnt/remote-teamdrive=NC /mnt/unionfs</span></li><li class="c0 c9 c1"><span>Note that is all one line, </span><span class="c21">just as it is in the original unedited file</span><span>. &nbsp;If you put /mnt/unionfs on its own line, add a line continuation character to the previous line, like this:<br></span><span class="c5">/mnt/local=RW:/mnt/remote=NC:/mnt/remote-teamdrive=NC \<br>/mnt/unionfs</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="9"><li class="c0 c6"><span class="c3">Reload all the services</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span class="c8 c5">sudo systemctl daemon-reload</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="10"><li class="c0 c6"><span class="c3">Start/restart the relevant services</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span class="c8 c5">sudo systemctl restart team_video_rclone_vfs_primer.service</span></li></ol><p class="c0 c1"><span class="c8 c5">sudo systemctl restart team_video_rclone_vfs.service</span></p><p class="c0 c1"><span class="c8 c5">sudo systemctl restart mergerfs.service</span></p><ol class="c12 lst-kix_4ntde9undnqh-0" start="11"><li class="c0 c6"><span class="c3">Enable the new services you created [and mergerfs just for good measure]</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span class="c8 c5">sudo systemctl enable team_video_rclone_vfs_primer.service</span></li></ol><p class="c0 c1"><span class="c8 c5">sudo systemctl enable team_video_rclone_vfs.service</span></p><p class="c0 c1"><span class="c8 c5">sudo systemctl enable mergerfs.service</span></p><ol class="c12 lst-kix_4ntde9undnqh-0" start="12"><li class="c0 c6"><span>If you are not configuring cloudplow, you&rsquo;re done. &nbsp;Everything should be visible under:<br></span><span class="c5">/mnt/unionfs<br></span><span class="c3">If you used those indicator folders I discussed above it will be obvious if it&rsquo;s working or not.</span></li></ol><p class="c0 c1"><span class="c8 c5">&#10140; &nbsp;~ ls -al /mnt/unionfs</span></p><p class="c0 c1"><span class="c8 c5">total 4118724</span></p><p class="c0 c1"><span class="c8 c5">drwxrwxr-x 1 seed seed &nbsp; &nbsp; 48 May &nbsp;8 19:08 &nbsp;.</span></p><p class="c0 c1"><span class="c8 c5">drwxr-xr-x 1 root root &nbsp; &nbsp;168 May &nbsp;8 18:35 &nbsp;..</span></p><p class="c0 c1"><span class="c8 c5">drwxrwxr-x 1 seed seed &nbsp; &nbsp; &nbsp;0 Aug &nbsp;2 &nbsp;2018 &nbsp;Backups</span></p><p class="c0 c1"><span class="c8 c5">drwxrwxr-x 1 seed seed &nbsp; &nbsp; 68 May &nbsp;7 22:40 &nbsp;Media</span></p><p class="c0 c1"><span class="c8 c5">-rwxrwxr-x 1 seed seed &nbsp; &nbsp; &nbsp;0 Apr 14 16:59 &nbsp;mounted.bin</span></p><p class="c0 c1"><span class="c8 c5 c34">drwxrwxr-x 1 seed seed &nbsp; &nbsp; &nbsp;0 May 17 23:36 &nbsp;TD-Teamdrive</span></p><ol class="c12 lst-kix_4ntde9undnqh-0" start="13"><li class="c0 c6"><span class="c3">If you want to configure multiple teamdrives in this way, repeat steps 2-11 for each Teamdrive [from the creation of the Oauth user through the enabling of the services if the step numbers change during my editing of this document]</span></li><li class="c0 c6"><span>Cloudplow configuration [</span><span class="c36 c21">optional</span><span class="c3">]</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span>I</span><span class="c21">f you want to keep all uploading as-is</span><span>&nbsp;[i.e. to My Drive] and you&rsquo;re going to add media to the teamdrive via other means, </span><span class="c21">there is no cloudplow modification required</span><span class="c3">.</span></li><li class="c0 c9 c1"><span class="c3">If, instead, you want to upload media from your cloudbox to teamdrive directly, proceed.</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="15"><li class="c0 c6"><span class="c3">Make a copy of the cloudplow config file</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span class="c8 c5">cd /opt/cloudplow &amp;&amp; cp config.json config.json.BACKUP</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="16"><li class="c0 c6"><span class="c3">Edit /opt/cloudplow/config.json</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span>Add your teamdrive to the &ldquo;hidden remotes&rdquo; section:<br></span><span class="c5 c8">&nbsp; &nbsp; &quot;hidden&quot;: {</span></li></ol><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;/mnt/local/.unionfs-fuse&quot;: {</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remotes&quot;: [</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;google&quot;</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; },</span></p><p class="c0 c1"><span>For example:<br></span><span class="c8 c5">&nbsp; &nbsp; &quot;hidden&quot;: {</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;/mnt/local/.unionfs-fuse&quot;: {</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remotes&quot;: [</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;google&quot;,</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive&quot;</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c8 c5">&nbsp; &nbsp; },</span></p><ol class="c12 lst-kix_4ntde9undnqh-1" start="2"><li class="c0 c9 c1"><span class="c3">Duplicate the &ldquo;google&rdquo; section under &ldquo;remotes&rdquo;</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-2 start" start="1"><li class="c0 c9 c17"><span>You&rsquo;ll take everything highlighted here [I&rsquo;ve removed everything you do not have to change for space, but follow the indentation, you need to copy it all]:<br></span><span class="c8 c5">&nbsp; &nbsp; &quot;remotes&quot;: {</span></li></ol><p class="c0 c17"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;google&quot;: {</span></p><p class="c0 c17"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remote&quot;: &quot;google:&quot;,</span></p><p class="c0 c17"><span class="c7 c5">...</span></p><p class="c0 c17"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;sync_remote&quot;: &quot;google:/Media&quot;,</span></p><p class="c0 c17"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_folder&quot;: &quot;/mnt/local/Media&quot;,</span></p><p class="c0 c17"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_remote&quot;: &quot;google:/Media&quot;</span></p><p class="c0 c17"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; },</span></p><p class="c0 c17"><span class="c3">Copy it to ABOVE the existing one, adding a comma at the end of the first one [I&rsquo;ve highlighted the line with the added comma here]:</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &quot;remotes&quot;: {</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;google&quot;: {</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remote&quot;: &quot;google:&quot;,</span></p><p class="c0 c17"><span class="c8 c5">...</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;sync_remote&quot;: &quot;google:/Media&quot;,</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_folder&quot;: &quot;/mnt/local/Media&quot;,</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_remote&quot;: &quot;google:/Media&quot;</span></p><p class="c0 c17"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;google&quot;: {</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remote&quot;: &quot;google:&quot;,</span></p><p class="c0 c17"><span class="c8 c5">...</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;sync_remote&quot;: &quot;google:/Media&quot;,</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_folder&quot;: &quot;/mnt/local/Media&quot;,</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_remote&quot;: &quot;google:/Media&quot;</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c17"><span class="c8 c28 c21">You&rsquo;re putting it ABOVE the original because I am assuming that this teamdrive is only being used for a subset of your media, like just the TV or just the Movies or the like, and you want it first in this list so it will process that subset before the more general section processes the entire Media directory.</span></p><ol class="c12 lst-kix_4ntde9undnqh-2" start="2"><li class="c0 c9 c17"><span>In that newly-added first section, change every &ldquo;google&rdquo; to the name of your teamdrive remote from rclone:<br></span><span class="c8 c5">&nbsp; &nbsp; &quot;remotes&quot;: {</span></li></ol><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;</span><span class="c5 c15">teamdrive</span><span class="c8 c5">&quot;: {</span></p><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remote&quot;: &quot;</span><span class="c5 c15">teamdrive</span><span class="c8 c5">:&quot;,</span></p><p class="c0 c17"><span class="c8 c5">...</span></p><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;sync_remote&quot;: &quot;</span><span class="c5 c15">teamdrive</span><span class="c8 c5">:/Media&quot;,</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_folder&quot;: &quot;/mnt/local/Media&quot;,</span></p><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_remote&quot;: &quot;</span><span class="c5 c15">teamdrive</span><span class="c8 c5">:/Media&quot;</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;google&quot;: {</span></p><p class="c0 c17"><span class="c8 c5">...</span></p><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><ol class="c12 lst-kix_4ntde9undnqh-2" start="3"><li class="c0 c9 c17"><span>Again, In that newly-added first section, change every &ldquo;/Media&rdquo; to the path that you want this remote to handle:<br></span><span class="c8 c5">&nbsp; &nbsp; &quot;remotes&quot;: {</span></li></ol><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;</span><span class="c5">teamdrive</span><span class="c8 c5">&quot;: {</span></p><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remote&quot;: &quot;</span><span class="c5">teamdrive</span><span class="c8 c5">:&quot;,</span></p><p class="c0 c17"><span class="c8 c5">...</span></p><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;sync_remote&quot;: &quot;</span><span class="c5">teamdrive</span><span class="c5">:/</span><span class="c5 c15">Media/TV</span><span class="c8 c5">&quot;,</span></p><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_folder&quot;: &quot;/mnt/local/</span><span class="c5 c15">Media/TV</span><span class="c8 c5">&quot;,</span></p><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_remote&quot;: &quot;</span><span class="c5">teamdrive</span><span class="c5">:/</span><span class="c5 c15">Media/TV</span><span class="c8 c5">&quot;</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;google&quot;: {</span></p><p class="c0 c17"><span class="c8 c5">...</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c17"><span>Now, down in the &ldquo;uploader&rdquo; section, do a similar thing, making this:</span></p><ol class="c12 lst-kix_4ntde9undnqh-2" start="4"><li class="c0 c9 c17"><span>Now, down in the &ldquo;uploader&rdquo; section, do a similar thing, making this:<br></span><span class="c8 c5">&nbsp; &nbsp; &quot;uploader&quot;: {</span></li></ol><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;google&quot;: {</span></p><p class="c0 c17"><span class="c8 c5">...</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;service_account_path&quot;: &quot;&quot;</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; }</span></p><p class="c0 c17"><span>Into this [don&rsquo;t forget the comma at the end]:<br></span><span class="c8 c5">&nbsp; &nbsp; &quot;uploader&quot;: {</span></p><p class="c0 c17"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive&quot;: {</span></p><p class="c0 c17"><span class="c5 c7">...</span></p><p class="c0 c17"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;service_account_path&quot;: &quot;&quot;</span></p><p class="c0 c17"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;google&quot;: {</span></p><p class="c0 c17"><span class="c8 c5">...</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;service_account_path&quot;: &quot;&quot;</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c13 c17"><span class="c8 c5"></span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; }</span></p><ol class="c12 lst-kix_4ntde9undnqh-2" start="5"><li class="c0 c9 c17"><span>Now add the path to your service account JSON files from step 1:<br></span><span class="c8 c5">&nbsp; &nbsp; &quot;uploader&quot;: {</span></li></ol><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive&quot;: {</span></p><p class="c0 c17"><span class="c8 c5">...</span></p><p class="c0 c17"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;service_account_path&quot;: &quot;</span><span class="c5 c15">/opt/sa-json</span><span class="c8 c5">&quot;</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;google&quot;: {</span></p><p class="c0 c17"><span class="c8 c5">...</span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c13 c17"><span class="c8 c5"></span></p><p class="c0 c17"><span class="c8 c5">&nbsp; &nbsp; }</span></p><p class="c0 c13"><span class="c3"></span></p><ol class="c12 lst-kix_4ntde9undnqh-0" start="17"><li class="c0 c6"><span class="c3">Restart the cloudplow service to get it to read the new config file</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-1 start" start="1"><li class="c0 c9 c1"><span class="c5">sudo systemctl restart cloudplow.service</span></li></ol><ol class="c12 lst-kix_4ntde9undnqh-0" start="18"><li class="c0 c6"><span class="c3">You&rsquo;re done.</span></li></ol><p class="c0 c13"><span class="c3"></span></p><hr style="page-break-before:always;display:none;"><h1 class="c26 c33" id="h.m3i813oiyoqr"><span class="c31 c28"></span></h1><h1 class="c26" id="h.eh2wxce3amov"><span class="c28 c31">Detailed notes:</span></h1><p class="c0 c13"><span class="c3"></span></p><h2 class="c19" id="h.2s3s5lg8i68r"><span class="c18">Creating service accounts. &nbsp;</span></h2><h3 class="c29" id="h.op3xpvmhdlxm"><span class="c27">Creating by hand:</span></h3><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Creating these accounts by hand is simple, but tedious. &nbsp;If you&rsquo;re creating a dozen or so, it&rsquo;s probably manageable. &nbsp;There are also scripts to create them for you. &nbsp;Those are discussed a but further down.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Go to the &ldquo;Service Accounts&rdquo; section in your Google API console:</span></p><p class="c0"><span><br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 315.50px; height: 141.57px;"><img alt="" src="images/image6.png" style="width: 315.50px; height: 141.57px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Click &ldquo;CREATE SERVICE ACCOUNT&rdquo;</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 315.50px; height: 194.15px;"><img alt="" src="images/image3.png" style="width: 315.50px; height: 194.15px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">Enter details, click &ldquo;CREATE&rdquo;</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 310.34px; height: 187.50px;"><img alt="" src="images/image9.png" style="width: 310.34px; height: 187.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span><br>Click &ldquo;CONTINUE&rdquo;<br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 319.50px; height: 313.36px;"><img alt="" src="images/image7.png" style="width: 319.50px; height: 313.36px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span>Click &ldquo;CREATE KEY&rdquo;<br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 314.50px; height: 211.18px;"><img alt="" src="images/image5.png" style="width: 314.50px; height: 211.18px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">Leave the default &ldquo;JSON&rdquo; selection, click &ldquo;CREATE&rdquo;</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 314.99px; height: 105.50px;"><img alt="" src="images/image10.png" style="width: 314.99px; height: 105.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">The file will download. &nbsp;This is one of the &ldquo;Service Account JSON&rdquo; files that we will be referring to later on. &nbsp;Click &ldquo;CLOSE&rdquo; then &ldquo;DONE&rdquo;.</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 318.03px; height: 105.50px;"><img alt="" src="images/image15.png" style="width: 318.03px; height: 105.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">The service account shows in the list. &nbsp;Repeat those steps for all the service accounts you want to create.</span></p><h3 class="c29" id="h.czxhxne5m5ns"><span class="c27">Creating by script:<br></span></h3><p class="c0"><span class="c3">If you want to create more than a few service accounts, there are a variety of scripted solutions. &nbsp;</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>One [for bash] can be found here:<br></span><span class="c22"><a class="c32" href="https://www.google.com/url?q=https://gist.github.com/mc2squared/01c933a8172a26af88285610a0e5af8d&amp;sa=D&amp;ust=1559144402925000">https://gist.github.com/mc2squared/01c933a8172a26af88285610a0e5af8d</a></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">That script will create 100 service accounts and save the JSON files locally ready for use. &nbsp;If you run it on your local machine, of course you&rsquo;ll have to upload the JSON files to your server. &nbsp;You can also run it on your server. &nbsp;It&rsquo;s a bash script, so there are some extra challenges if you&rsquo;re running Windows locally and want to run the script locally..</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>To run the script you will have to install the Google Cloud SDK. &nbsp;That process is documented here:<br></span><span class="c22"><a class="c32" href="https://www.google.com/url?q=https://cloud.google.com/sdk/docs/quickstarts&amp;sa=D&amp;ust=1559144402926000">https://cloud.google.com/sdk/docs/quickstarts</a></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Once you&rsquo;ve installed the SDK, running that script is quick and easy. &nbsp;I don&rsquo;t default to that suggestion because personally I think the 100 accounts is overkill [I think I&rsquo;ve only ever used 9 of mine during weeks of constant uploading] and installing the Cloud SDK to avoid a few dozen clicks to create ten service accounts seems counterproductive.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">There is also the service_account_maker script by Cloudbox developer l3uddz:</span></p><p class="c0"><span class="c22"><a class="c32" href="https://www.google.com/url?q=https://github.com/l3uddz/service_account_maker&amp;sa=D&amp;ust=1559144402928000">https://github.com/l3uddz/service_account_maker</a></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">There&rsquo;s little documentation, but it&rsquo;s quite capable.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">There is nothing magic about the name of these JSON files. &nbsp;Rename them however you like. &nbsp;There are scripts around that iterate through a directory of JSON files to upload tons of stuff using rclone. &nbsp;These scripts typically rely on the json files being named in some predictable way. &nbsp;Here&rsquo;s one example:</span></p><p class="c0"><span class="c22"><a class="c32" href="https://www.google.com/url?q=https://gist.github.com/chazlarson/51a9843f84ed33b726d07aedf1b59ab4&amp;sa=D&amp;ust=1559144402929000">https://gist.github.com/chazlarson/51a9843f84ed33b726d07aedf1b59ab4</a></span></p><p class="c0"><span class="c3"><br>For use with something like that you can rename all these files to &ldquo;sa-1.json&rdquo; or the like.</span></p><h2 class="c19" id="h.5ijc47fky7ci"><span class="c18">Creating an Oauth user. &nbsp;</span></h2><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">This is not required; you can add the teamdrive using one of the users you created when you installed cloudbox. &nbsp;These users are free, though, so there&rsquo;s no reason NOT to forestall any API or transfer quota issues by just giving each Teamdrive its own user account.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">The process shown here is the same as you used when you set up Cloudbox for the first time.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Go to the &ldquo;Credentials&rdquo; section in your Google API console:</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 309.50px; height: 158.72px;"><img alt="" src="images/image4.png" style="width: 309.50px; height: 158.72px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c3"><br></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 313.50px; height: 200.96px;"><img alt="" src="images/image13.png" style="width: 313.50px; height: 200.96px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">You can see that I have OAuth credentials for each of my four teamdrives.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Click &ldquo;Create credentials&rdquo; and choose OAuth from the menu:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 307.85px; height: 185.50px;"><img alt="" src="images/image21.png" style="width: 307.85px; height: 185.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span>Choose &ldquo;Other&rdquo; for the Application Type and enter a name, then click &ldquo;Create&rdquo;:</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 315.68px; height: 171.50px;"><img alt="" src="images/image20.png" style="width: 315.68px; height: 171.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>The client ID and secret will be displayed. &nbsp;You can copy them from here, but they&rsquo;ll be accessible elsewhere.<br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 312.00px; height: 225.50px;"><img alt="" src="images/image17.png" style="width: 312.00px; height: 225.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c3"><br></span></p><p class="c0"><span>Your new user is in the list:<br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 310.50px; height: 140.82px;"><img alt="" src="images/image14.png" style="width: 310.50px; height: 140.82px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c3"><br></span></p><p class="c0"><span class="c3">Click the pencil icon on the right to see the ID and secret again, or to download a JSON file if you wish:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 317.50px; height: 142.98px;"><img alt="" src="images/image2.png" style="width: 317.50px; height: 142.98px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c13"><span class="c3"></span></p><h2 class="c19" id="h.i3zebiytaa2"><span class="c18">Creating team drive. &nbsp;</span></h2><p class="c0"><span class="c3">Here&rsquo;s the reason for this whole thing.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Go to the Main Google Drive page for your GSuites account.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Right-click on the Team Drives heading and choose &ldquo;New Team Drive&hellip;&rdquo;:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 314.75px; height: 114.50px;"><img alt="" src="images/image22.png" style="width: 314.75px; height: 114.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>Enter a name and click CREATE:<br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 317.34px; height: 148.50px;"><img alt="" src="images/image1.png" style="width: 317.34px; height: 148.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">There it is:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 323.04px; height: 175.50px;"><img alt="" src="images/image12.png" style="width: 323.04px; height: 175.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Now, since these teamdrives are going to be added to your unionfs and you probably want the media that you add to the teamdrives to just be available to your various applications without your having to add new folders to those applications, I&rsquo;d suggest duplicating the file structure that Cloudbox normally uses on these teamdrives.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">For example, my TV Teamdrive:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 286.54px; height: 264.50px;"><img alt="" src="images/image8.png" style="width: 286.54px; height: 264.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">Once this Teamdrive is added to the mergerfs, this TV directory will get merged with the TV subdirectory that is already on My Drive seamlessly.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">I create those &ldquo;TD-NAME&rdquo; folders so I can tell at a glance that the teamdrives have been added to the mergerfs without having to look for something specific down inside the /Media directory. &nbsp;Not something that gets used very much, but handy at least initially.</span></p><p class="c0 c13"><span class="c3"></span></p><h2 class="c19" id="h.y6qgbuksfmxo"><span class="c18">Share the teamdrive with the service accounts using their email address</span></h2><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Click &ldquo;Add members&rdquo; and then paste in the email addresses of the service accounts that you want to have access to this drive:</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 299.54px; height: 240.50px;"><img alt="" src="images/image18.png" style="width: 299.54px; height: 240.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">I then choose &ldquo;Manager&rdquo; from the dropdown since I figure these service accounts will only be used by me in controlled circumstances, so let them have All The Privileges just to avoid any problems later.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Tick the &ldquo;Skip Sending Notifications&rdquo; box since there&rsquo;s no need to send email to all these robots.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Click ADD. You&rsquo;ll get a warning.</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 315.50px; height: 89.49px;"><img alt="" src="images/image19.png" style="width: 315.50px; height: 89.49px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">That&rsquo;s fine. &nbsp;Click CONTINUE.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">It might take a little while for the &ldquo;1 member&rdquo; thing at the top to update, but if you click it you can review the members:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 306.50px; height: 114.45px;"><img alt="" src="images/image16.png" style="width: 306.50px; height: 114.45px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">If you want to add many many Service Accounts, it&rsquo;s probably easier with a Google Group.</span></p><p class="c0"><span class="c3">BLAH BLAH DETAILS ON GOOGLE GROUP SETUP</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>For example, here&rsquo;s my TV teamdrive, with a group [containing 98 service accounts] added as a member:<br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 306.98px; height: 183.50px;"><img alt="" src="images/image11.png" style="width: 306.98px; height: 183.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c13"><span class="c3"></span></p><h2 class="c19" id="h.ogr6ksqakxbl"><span class="c18">Creating rclone remote. &nbsp;</span></h2><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">This is basically the same process as you used for your original rclone remote, except that at the end you&rsquo;ll say &ldquo;yes&rdquo; to the teamdrive question. &nbsp;Use the Client ID and Secret from the OAuth user you just created. &nbsp;In the transcript below I&rsquo;ve removed a lot of comments and instructions to just highlight the answers you give.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0 c2"><span class="c11 c5">&#10140; &nbsp;~ rclone config</span></p><p class="c0 c2"><span class="c11 c5">Current remotes:</span></p><p class="c0 c2"><span class="c11 c5">...</span></p><p class="c0 c2"><span class="c5 c16">e/n/d/r/c/s/q&gt; </span><span class="c11 c20">n</span></p><p class="c0 c2"><span class="c5 c16">name&gt; </span><span class="c11 c20">teamdrive</span></p><p class="c0 c2"><span class="c11 c5">Type of storage to configure.</span></p><p class="c0 c2"><span class="c11 c5">...</span></p><p class="c0 c2"><span class="c5 c16">Storage&gt; </span><span class="c11 c20">12</span></p><p class="c0 c2 c13"><span class="c11 c5"></span></p><p class="c0 c2"><span class="c11 c5">Google Application Client Id</span></p><p class="c0 c2"><span class="c11 c5">...</span></p><p class="c0 c2"><span class="c5 c16">client_id&gt; </span><span class="c11 c20">YOUR CLIENT ID</span></p><p class="c0 c2"><span class="c11 c5">Google Application Client Secret</span></p><p class="c0 c2"><span class="c11 c5">...</span></p><p class="c0 c2"><span class="c5 c16">client_secret&gt; </span><span class="c11 c20">YOUR CLIENT SECRET</span></p><p class="c0 c2"><span class="c11 c5">Scope that rclone should use when requesting access from drive.</span></p><p class="c0 c2"><span class="c11 c5">...</span></p><p class="c0 c2"><span class="c11 c5">scope&gt; 1</span></p><p class="c0 c2"><span class="c11 c5">ID of the root folder</span></p><p class="c0 c2"><span class="c11 c5">...</span></p><p class="c0 c2"><span class="c11 c5">root_folder_id&gt;</span></p><p class="c0 c2"><span class="c11 c5">Service Account Credentials JSON file path</span></p><p class="c0 c2"><span class="c11 c5">...</span></p><p class="c0 c2"><span class="c11 c5">service_account_file&gt;</span></p><p class="c0 c2"><span class="c11 c5">Edit advanced config? (y/n)</span></p><p class="c0 c2"><span class="c11 c5">...</span></p><p class="c0 c2"><span class="c5 c16">y/n&gt; </span><span class="c11 c20">n</span></p><p class="c0 c2"><span class="c11 c5">Remote config</span></p><p class="c0 c2"><span class="c11 c5">Use auto config?</span></p><p class="c0 c2"><span class="c11 c5">...</span></p><p class="c0 c2"><span class="c5 c16">y/n&gt; </span><span class="c11 c20">n</span></p><p class="c0 c2"><span class="c11 c5">If your browser doesn&#39;t open automatically go to the following link: https://accounts.google.com/o/oauth2/auth?BLAH-BLAH-BLAH</span></p><p class="c0 c2"><span class="c11 c5">Log in and authorize rclone for access</span></p><p class="c0 c2"><span class="c5 c16">Enter verification code&gt; </span><span class="c11 c20">YOUR VERIFICATION CODE</span></p><p class="c0 c2"><span class="c11 c5">Configure this as a team drive?</span></p><p class="c0 c2"><span class="c11 c5">...</span></p><p class="c0 c2"><span class="c5 c34 c16">y/n&gt; </span><span class="c11 c14">y</span></p><p class="c0 c2"><span class="c4">Fetching team drive list...</span></p><p class="c0 c2"><span class="c4">Choose a number from below, or type in your own value</span></p><p class="c0 c2"><span class="c4">&nbsp;1 / Books</span></p><p class="c0 c2"><span class="c4">&nbsp; &nbsp;\ &quot;DECAFBAD&quot;</span></p><p class="c0 c2"><span class="c4">&nbsp;2 / Example Team Drive</span></p><p class="c0 c2"><span class="c4">&nbsp; &nbsp;\ &quot;DEADBEEF&quot;</span></p><p class="c0 c2"><span class="c4">&nbsp;3 / Media</span></p><p class="c0 c2"><span class="c4">&nbsp; &nbsp;\ &quot;FEEDFACE&quot;</span></p><p class="c0 c2"><span class="c4">...</span></p><p class="c0 c2"><span class="c5 c16 c34">Enter a Team Drive ID&gt; </span><span class="c11 c14">2</span></p><p class="c0 c2"><span class="c11 c5">--------------------</span></p><p class="c0 c2"><span class="c11 c5">[teamdrive-media]</span></p><p class="c0 c2"><span class="c11 c5">type = drive</span></p><p class="c0 c2"><span class="c11 c5">client_id = YOUR CLIENT ID</span></p><p class="c0 c2"><span class="c11 c5">client_secret = YOUR CLIENT SECRET</span></p><p class="c0 c2"><span class="c11 c5">scope = drive</span></p><p class="c0 c2"><span class="c11 c5">token = {BLAH}</span></p><p class="c0 c2"><span class="c11 c5">team_drive = DEADBEEF</span></p><p class="c0 c2"><span class="c11 c5">--------------------</span></p><p class="c0 c2"><span class="c11 c5">y) Yes this is OK</span></p><p class="c0 c2"><span class="c11 c5">e) Edit this remote</span></p><p class="c0 c2"><span class="c11 c5">d) Delete this remote</span></p><p class="c0 c2"><span class="c5 c16">y/e/d&gt; </span><span class="c11 c20">y</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0 c13"><span class="c3"></span></p><h2 class="c19" id="h.xbt5ldwfcxhh"><span class="c18">Create a mount point for the teamdrive.</span></h2><p class="c0"><span class="c3">&ldquo;Mount point&rdquo; means &ldquo;the point in the file system at which you want this device to appear&rdquo;. &nbsp;It&rsquo;s a directory, and once you&rsquo;ve connected your teamdrive to your system [using rclone_vfs] the files on your teamdrive will appear in that directory.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">You&rsquo;re just creating a directory here. &nbsp;As noted above, you may need to use sudo to create the directory and to reset the ownership and permissions. &nbsp;Make sure it looks just like the existing /mnt/remote.</span></p><h2 class="c19" id="h.lzd6vieahzbk"><span class="c18">Make copies of the rclone_vfs service files for use with this teamdrive</span></h2><p class="c0"><span class="c3">Each of these sets of three files accomplish the mounting, using rclone_vfs, of the temadrive to the mountpoint directory you just created. &nbsp;The three files are:</span></p><p class="c0"><span class="c8 c5">/etc/systemd/system/rclone_vfs.service</span></p><p class="c0 c24"><span class="c3">Actually does the mounting of the teamdrive to your mountpoint</span></p><p class="c0"><span class="c8 c5">/etc/systemd/system/rclone_vfs_primer.service</span></p><p class="c0 c24"><span class="c3">Primes the reclone_vfs cache for the mount point</span></p><p class="c0"><span class="c8 c5">/etc/systemd/system/rclone_vfs_primer.timer</span></p><p class="c0 c24"><span class="c3">Used by the previous service file</span></p><p class="c0 c13"><span class="c8 c5"></span></p><p class="c0"><span class="c3">Note that #2 references #1 internally:</span></p><p class="c0"><span class="c5 c11">...</span></p><p class="c0"><span class="c11 c5">[Unit]</span></p><p class="c0"><span class="c11 c5">Description=Rclone VFS Primer - Service</span></p><p class="c0"><span class="c11 c5 c15">Requires=rclone_vfs.service</span></p><p class="c0"><span class="c11 c5 c15">After=rclone_vfs.service</span></p><p class="c0"><span class="c11 c5">...</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">And the timer file is just linked by virtue of having the same name, so make sure you double-check the names on all three files.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>You&rsquo;ll probably need to use sudo to copy the files:<br></span><span class="c8 c5">cd /etc/systemd/system/</span></p><p class="c0"><span class="c8 c5">sudo cp rclone_vfs.service &nbsp; &nbsp; &nbsp; &nbsp;teamdrive_vfs.service</span></p><p class="c0"><span class="c8 c5">sudo cp rclone_vfs_primer.service teamdrive_vfs_primer.service</span></p><p class="c0"><span class="c8 c5">sudo cp rclone_vfs_primer.timer &nbsp; teamdrive_vfs_primer.timer</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>The first two files contain a port reference:<br> </span><span class="c8 c5">--rc-addr=localhost:5572 \</span></p><p class="c0"><span>So make sure that you change that in both files. &nbsp;If you&rsquo;re adding multiple team drives using this guide, change each set. &nbsp;For example, my teamdrives:<br></span><span class="c11 c5">team_tv_rclone_vfs_primer.service: &nbsp;--rc-addr=localhost:5573 \</span></p><p class="c0"><span class="c11 c5">team_tv_rclone_vfs.service: &nbsp;--rc-addr=localhost:5573 \</span></p><p class="c0 c13"><span class="c11 c5"></span></p><p class="c0"><span class="c11 c5">team_music_rclone_vfs_primer.service: &nbsp;--rc-addr=localhost:5574 \</span></p><p class="c0"><span class="c11 c5">team_music_rclone_vfs.service: &nbsp;--rc-addr=localhost:5574 \</span></p><p class="c0 c13"><span class="c11 c5"></span></p><p class="c0"><span class="c11 c5">team_movie_rclone_vfs_primer.service: &nbsp;--rc-addr=localhost:5575 \</span></p><p class="c0"><span class="c11 c5">team_movie_rclone_vfs.service: &nbsp;--rc-addr=localhost:5575 \</span></p><p class="c0 c13"><span class="c11 c5"></span></p><p class="c0"><span class="c11 c5">team_books_rclone_vfs_primer.service: &nbsp;--rc-addr=localhost:5576 \</span></p><p class="c0"><span class="c11 c5">team_books_rclone_vfs.service: &nbsp;--rc-addr=localhost:5576 \</span></p><p class="c0 c13"><span class="c11 c5"></span></p><p class="c0"><span class="c11 c5">team_video_rclone_vfs_primer.service: &nbsp;--rc-addr=localhost:5577 \</span></p><p class="c0"><span class="c11 c5">team_video_rclone_vfs.service: &nbsp;--rc-addr=localhost:5577 \</span></p><p class="c0 c13"><span class="c11 c5"></span></p><h2 class="c19" id="h.2kuul48mxb4f"><span class="c18">Edit the mergerfs service file to include the new teamdrive in the mergerfs.</span></h2><p class="c0"><span>&ldquo;Mergerfs&rdquo; is the service that, as the name might suggest, </span><span class="c21">merges</span><span>&nbsp;multiple </span><span class="c21">file systems</span><span class="c3">&nbsp;and presents them as one.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>The stock configuration merges the contents of </span><span class="c5">/mnt/local</span><span>&nbsp;[which is where new downloads go] with the contents of </span><span class="c5">/mnt/remote</span><span>&nbsp;[which is the contents of your Google Drive] and presents them </span><span class="c21">together</span><span>&nbsp;at the location </span><span class="c5">/mnt/unionfs</span><span class="c3">.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>In this way, all your applications can look at </span><span class="c5">/mnt/unionfs</span><span class="c3">&nbsp;and see all your files, whether Cloudplow has moved them to the cloud yet or not.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>You may note that none of the tools are moving things specifically to </span><span class="c5">/mnt/local</span><span>. &nbsp;Everybody just works with </span><span class="c5">/mnt/unionfs</span><span>, yet things end up in </span><span class="c5">/mnt/local</span><span class="c3">. &nbsp;Wha?<br></span></p><p class="c0"><span>The reason is that in the mergerfs config, </span><span class="c5">/mnt/local</span><span>&nbsp;is noted as the only write-enabled location, so any file or directory that gets created in </span><span class="c5">/mnt/unionfs</span><span>&nbsp;gets created in </span><span class="c5">/mnt/local</span><span>&nbsp;without having to be directed there specifically. &nbsp;Later, cloudplow will move it to the cloud, and it will no longer appear in </span><span class="c5">/mnt/local</span><span>; it will then appear in </span><span class="c5">/mnt/remote</span><span>, but its location within </span><span class="c5">/mnt/unionfs</span><span class="c3">&nbsp;will not have changed, so your applications don&rsquo;t notice the move.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">There&rsquo;s one line to edit in the mergerfs.service file:</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Stock:</span></p><p class="c0"><span class="c8 c5">/mnt/local=RW:/mnt/remote=NC /mnt/unionfs</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Modified:</span></p><p class="c0"><span class="c8 c5">/mnt/local=RW:/mnt/remote=NC:/mnt/remote-teamdrive=NC /mnt/unionfs</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">As you may have guessed, &ldquo;RW&rdquo; means Read-Write. &nbsp;&ldquo;NC&rdquo; means &ldquo;No Create&rdquo;. &nbsp;Any teamdrives you add here should be tagged as &ldquo;NC&rdquo;, since they cannot be written to directly.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>Note that is a single line: <br></span><span class="c8 c5">DIRECTORY_1:DIRECTORY_2:DIRECTORY_3 MERGED</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Be sure that you don&rsquo;t add a line feed where that space is before the merged directory. &nbsp;If you do, mergerfs won&rsquo;t start and you&rsquo;ll see this error when you go looking for errors:</span></p><p class="c0"><span class="c8 c5">mergerfs.service - MergerFS Mount</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp;Loaded: error (Reason: Invalid argument)</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">That&rsquo;s because the linefeed is &ldquo;hiding&rdquo; that last argument to the mergerfs command. &nbsp;That &ldquo;ExecStart&rdquo; section in the service file is one command; you can see the line continuation characters on all the previous lines.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">This works:</span></p><p class="c0"><span class="c8 c5">/mnt/local=RW:/mnt/remote=NC:/mnt/remote-teamdrive=NC /mnt/unionfs</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">So does this [because we&rsquo;ve added a line continuation character]:</span></p><p class="c0"><span class="c8 c5">/mnt/local=RW:/mnt/remote=NC:/mnt/remote-teamdrive=NC \</span></p><p class="c0"><span class="c8 c5">/mnt/unionfs</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">But this looks like two commands; with the first missing an argument:</span></p><p class="c0"><span class="c8 c5">/mnt/local=RW:/mnt/remote=NC:/mnt/remote-teamdrive=NC</span></p><p class="c0"><span class="c8 c5">/mnt/unionfs</span></p><p class="c0 c13"><span class="c3"></span></p><h2 class="c19" id="h.2kuul48mxb4f-1"><span class="c18">Reload all the services</span></h2><p class="c0"><span class="c3">You&rsquo;ve just changed a bunch of service files, so you need to tell the OS to go check them out.</span></p><h2 class="c19" id="h.2kuul48mxb4f-2"><span class="c18">Start/restart the relevant services</span></h2><p class="c0"><span class="c3">I use the restart command here, which should work fine for services that aren&rsquo;t already running [like the ones you just created]. &nbsp;If you have a problem, replace &ldquo;restart&rdquo; with &ldquo;start&rdquo;.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">The mergerfs service gets restarted because you want it to read in the new configuration including your teamdrive.</span></p><h2 class="c19" id="h.2kuul48mxb4f-3"><span class="c18">Enable the new services you created [and mergerfs just for good measure]</span></h2><p class="c0"><span class="c3">Enabling the services makes them start up automagically when the machine starts up.</span></p><h2 class="c19" id="h.2kuul48mxb4f-4"><span class="c18">If you are not configuring cloudplow, you&rsquo;re done.</span></h2><p class="c0"><span>At this point, the files from your teamdrive should be appearing underneath </span><span class="c5">/mnt/unionfs</span><span class="c3">. &nbsp;If you don&rsquo;t have any files there yet, it can be hard to determine if that&rsquo;s true, which is why I create those indicator folders. &nbsp;There&rsquo;s some discussion about this above in the teamdrive-creation notes. &nbsp;Here are some directory listings from my server showing the results [I&rsquo;ve removed some files from the listings to highlight what&rsquo;s important here]:<br></span></p><p class="c0"><span>My TV teamdrive, mounted at </span><span class="c5">/mnt/remote-tv</span><span class="c3">:</span></p><p class="c0"><span class="c8 c5">&#10140; &nbsp;~ ls /mnt/remote-tv</span></p><p class="c0"><span class="c5">Media &nbsp; &nbsp; &nbsp; &nbsp;mounted.bin &nbsp;</span><span class="c8 c5 c25">TD-TV</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">You can see the indicator folder there.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>My Google Drive, mounted at </span><span class="c5">/mnt/remote</span><span class="c3">:</span></p><p class="c0"><span class="c8 c5">&#10140; &nbsp;~ ls /mnt/remote</span></p><p class="c0"><span class="c5">&nbsp;</span><span class="c5 c23">Backups</span><span class="c8 c5">&nbsp; &nbsp; &nbsp;Media &nbsp; &nbsp; &nbsp; &nbsp;mounted.bin</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">That&rsquo;s the view of &ldquo;My Drive&rdquo;, which doesn&rsquo;t have any indicator folder.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Note that each of those directories contain items which are unique to them. &nbsp;They are highlighted above.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>And last the merged filesystem, which combines those two filesystems, mounted at /mnt/unionfs:<br></span><span class="c8 c5">&#10140; &nbsp;~ ls /mnt/unionfs</span></p><p class="c0"><span class="c5">&nbsp;</span><span class="c5 c23">Backups</span><span class="c5">&nbsp; &nbsp; &nbsp;Media &nbsp; &nbsp; &nbsp; &nbsp;mounted.bin &nbsp;</span><span class="c5 c25">TD-TV</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">We see &ldquo;Backups&rdquo;and &ldquo;TD-TV&rdquo; here [highlighted], so we know at a glance that the files from both of those mounts are part of this merged filesystem. &nbsp;</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Without that &ldquo;TD-TV&rdquo; indicator folder we&rsquo;d have to go looking inside the Media directory and find some other file that we know to be only on the TV teamdrive to verify this.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Just a convenience, and it&rsquo;s hopefully only useful once, when you set it up, but it&rsquo;s free and takes no space, so why not?</span></p><p class="c0 c13"><span class="c3"></span></p><h2 class="c19" id="h.2kuul48mxb4f-5"><span>Cloudplow configuration [</span><span class="c21 c36">optional</span><span class="c18">]</span></h2><p class="c0"><span class="c3">If you&rsquo;re not configuring Cloudplow to upload files to this teamdrive, you can stop here. &nbsp;The rest of the guide has to do with Cloudplow.</span></p><h2 class="c19" id="h.2kuul48mxb4f-6"><span class="c18">Make a copy of the cloudplow config file</span></h2><p class="c0"><span class="c3">Just good practice, nothing specific to this guide. &nbsp;Make a backup copy of the file and you can recover immediately from whatever you mess up.</span></p><h2 class="c19" id="h.2kuul48mxb4f-7"><span class="c18">Edit /opt/cloudplow/config.json</span></h2><p class="c0"><span class="c3">This is an area where for me just using the same name all over the place helps a lot.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">You&rsquo;re going to add or modify three things. &nbsp;A &ldquo;hidden&rdquo; entry, a &ldquo;remotes&rdquo; entry, and an &ldquo;uploader&rdquo; entry. &nbsp;</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">For this guide, the assumption is that you want all uploads to go to the Teamdrive, so we&rsquo;re adding the teamdrive entry to the front of the list.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Here are the things you will be changing, with all the rest of the file cut away for size:</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">{</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &quot;hidden&quot;: {</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &quot;/mnt/local/.unionfs-fuse&quot;: {</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remotes&quot;: [</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;</span><span class="c10">teamdrive</span><span class="c3">&quot;</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; },</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &quot;remotes&quot;: {</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &quot;</span><span class="c10">teamdrive</span><span class="c3">&quot;: {</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remote&quot;: &quot;</span><span class="c10">teamdrive</span><span class="c3">:&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;sync_remote&quot;: &quot;</span><span class="c10">teamdrive</span><span class="c3">:/Media&quot;,</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_folder&quot;: &quot;/mnt/local/Media&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_remote&quot;: &quot;</span><span class="c10">teamdrive</span><span class="c3">:/Media&quot;</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; },</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &quot;uploader&quot;: {</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &quot;</span><span class="c10">teamdrive</span><span class="c3">&quot;: {</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;service_account_path&quot;: &quot;/opt/sa-json/&quot;</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c3">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c3">}</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">REMEMBER: EVERYTHING ELSE IS CUT AWAY FOR SIZE IN THIS DOCUMENT. &nbsp;That &ldquo;teamdrive&rdquo; remote doesn&rsquo;t have just that one line in it, for example; it&rsquo;s a copy of the existing one where ONLY THAT ONE LINE IS CHANGED.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">The &ldquo;hidden&rdquo; entry is not used with mergerfs, so far as I know, so this part is probably vestigal, but why not create it. &nbsp;You&rsquo;ve already spent more time wondering about it than it takes to create the entry, so just do it. &nbsp;If Cloudplow expects it there, it&rsquo;s there; if it doesn&rsquo;t look for it, no harm done by having it there.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">On the uploaders and remotes.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">These are processed in order; I&rsquo;m not sure which gets iterated through, but if you watch cloudplow you&rsquo;ll see them go by in the order in which they appear in this file.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">If you want to direct all uploading to the teamdrive, you should do this: Everywhere the name of your google remote appears in this file, change it to the name you gave your rclone remote. &nbsp;Then set the &ldquo;service_account_path&rdquo; to the directory where you stored all those JSON files earlier.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">All the references are highlighted above.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">You want to do that just to avoid the chance of something getting downloaded WHILE THE TEAMDRIVE UPLOAD IS BEING PROCESSED. &nbsp;If that were to happen, that new download may get uploaded to My Drive.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">All those locations are highlighted above, and here&rsquo;s where you see the beauty of just using the same name throughout. &nbsp;Some of those instances refer to locations within this file. &nbsp;Some refer to things outside the file, like your rclone remotes. &nbsp;If you use the exact same name everywhere you don&rsquo;t have to care or keep track.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">Chances are, however, that this teamdrive includes some subset of media types. &nbsp;It&rsquo;s only TV, or what have you. &nbsp;That would mean you want the TV to be uploaded to the teamdrive and everything else to My Drive, or to another teamdrive.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>For upload purposes, you then want that subset to be looked at first, since the existing My Drive uploader will upload everything below </span><span class="c5">/mnt/local/Media</span><span class="c3">. &nbsp;If it runs first, then your TV will have been uploaded and deleted from your local drive before the more specific uploader/remote gets processed.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span>To prevent this, order your uploader/remotes in this config file so that the most specific ones run first. &nbsp;This ensures that, for example. </span><span class="c5">/mnt/local/Media/TV</span><span>&nbsp;gets uploaded to your TV teamdrive before </span><span class="c5">/mnt/local/Media/</span><span class="c3">&nbsp;gets uploaded to your General teamdrive, or however you have it configured. &nbsp;In this case you still run the risk of new TV appearing and maybe getting caught up in the &ldquo;catch-all&rdquo; uploader.</span></p><p class="c0 c13"><span class="c3"></span></p><p class="c0"><span class="c3">What I did was create five teamdrives, one for each type of media, then configured cloudplow with five uploader/remote pairs, one for each media type, so there is no overlap.<br></span></p><p class="c0"><span class="c3">Here&rsquo;s the config, with redundant or uninteresting portions redacted for space. &nbsp;Every place I&rsquo;ve left something out it&rsquo;s either the same as the default config or it follows the pattern demonstrated by the &ldquo;Books&rdquo; and &ldquo;Movies&rdquo; entries :<br></span></p><p class="c0"><span class="c8 c5">{</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &quot;core&quot;: {</span></p><p class="c0"><span class="c8 c5">...</span></p><p class="c0 c13"><span class="c8 c5"></span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &quot;hidden&quot;: {</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;/mnt/local/.unionfs-fuse&quot;: {</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remotes&quot;: [</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-books&quot;,</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-movies&quot;,</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-music&quot;,</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-tv&quot;,</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-video&quot;</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">...</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &quot;remotes&quot;: {</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-books&quot;: {</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hidden_remote&quot;: &quot;teamdrive-books:&quot;,</span></p><p class="c0"><span class="c8 c5">...</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;remove_empty_dir_depth&quot;: 2,</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;sync_remote&quot;: &quot;teamdrive-books:/Media/Books&quot;,</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_folder&quot;: &quot;/mnt/local/Media/Books&quot;,</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_remote&quot;: &quot;teamdrive-books:/Media/Books&quot;</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-movies&quot;: {</span></p><p class="c0"><span class="c8 c5">...</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;remove_empty_dir_depth&quot;: 2,</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;sync_remote&quot;: &quot;teamdrive-movies:/Media/Movies&quot;,</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_folder&quot;: &quot;/mnt/local/Media/Movies&quot;,</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;upload_remote&quot;: &quot;teamdrive-movies:/Media/Movies&quot;</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-music&quot;: {</span></p><p class="c0"><span class="c8 c5">. . . [changes as above]</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-tv&quot;: {</span></p><p class="c0"><span class="c8 c5">. . . [changes as above]</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-video&quot;: {</span></p><p class="c0"><span class="c8 c5">. . . [changes as above]</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &quot;syncer&quot;: {</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &quot;uploader&quot;: {</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-books&quot;: {</span></p><p class="c0"><span class="c8 c5">...</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;service_account_path&quot;: &quot;/opt/cloudplow/sa-json/&quot;</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-movies&quot;: {</span></p><p class="c0"><span class="c8 c5">...</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;service_account_path&quot;: &quot;/opt/cloudplow/sa-json/&quot;</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-music&quot;: {</span></p><p class="c0"><span class="c8 c5">...</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;service_account_path&quot;: &quot;/opt/cloudplow/sa-json/&quot;</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-tv&quot;: {</span></p><p class="c0"><span class="c8 c5">...</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;service_account_path&quot;: &quot;/opt/cloudplow/sa-json/&quot;</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;teamdrive-video&quot;: {</span></p><p class="c0"><span class="c8 c5">...</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;service_account_path&quot;: &quot;/opt/cloudplow/sa-json/&quot;</span></p><p class="c0"><span class="c8 c5">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c5">}</span></p><h2 class="c19" id="h.2kuul48mxb4f-8"><span class="c18">Restart the cloudplow service to get it to read the new config file</span></h2><p class="c0"><span>Just like the other services; you&rsquo;ve changed the config and you have to restart the service to get it to actually pay attention to that.</span></p></body></html>